# 产品需求文档（PRD）——“UNOFOOD”小程序（对标 Too Good To Go）

## 一、产品概述
- 产品名称：UNOFOOD
- 产品形态：微信小程序（消费者端 + 商家端 + 运营后台）
- 产品愿景：连接消费者与餐饮商家，将临期或当日未售完的食物以“惊喜袋”形式优惠售出，减少浪费、降低商家损失、让消费者以更低成本获得高质量食品。
- 核心价值：
  - 消费者：低价、便捷、安心（平台把关合规与品质），就近取货。
  - 商家：快速处置剩余库存、获取增量客流、提升品牌社会责任形象。
  - 平台：构建可信交易与履约闭环，促进可持续消费。

## 二、用户与角色
- 消费者（C 端）：浏览附近“惊喜袋”、下单支付、到店自提、评价与售后。
- 商家（B 端）：发布“惊喜袋”、管理库存与提货时间、核销订单、售后处理。
- 运营/客服（平台端）：商家准入审核、内容与活动配置、风控与纠纷处理、数据分析。

## 三、使用场景与用户旅程
- 场景 A（消费者）：
  1) 打开小程序授权定位，浏览附近店铺与惊喜袋；
  2) 选购并微信支付；
  3) 在指定提货时间段到店，出示核销码；
  4) 完成提货，可评价与申请售后（如未能按时取货或质量问题）。
- 场景 B（商家）：
  1) 创建惊喜袋：设置数量、可提货时间段、打包内容范围（不展示具体单品），价格与限购规则；
  2) 实时查看订单与到店核销；
  3) 提货结束后结算与报表；
  4) 处理退款/纠纷，优化下次发布策略。
- 场景 C（运营）：
  1) 审核商家入驻与资质；
  2) 区域活动与曝光位配置；
  3) 风控巡检（异常订单、频繁退款、虚假库存等）；
  4) 数据看板与增长分析。

## 四、功能需求分级（MVP 优先级）
- P0（MVP 必须）：
  - 登录注册与账号体系（微信登录，手机号校验可在后续P1）。
  - 地理位置与附近店铺发现（基于腾讯位置服务）。
  - “惊喜袋”列表、详情与下单支付（微信支付）。
  - 订单管理（未提货、已提货、退款中、已退款）。
  - 提货核销（商家端扫码/码值核销）。
  - 订阅消息通知（下单成功、提货提醒、退款进度）。
  - 商家端发布与库存管理（设置数量、提货时间段、价格、限购、上下架）。
  - 基础运营后台（商家审核、店铺管理、订单查询、简单数据看板）。
- P1（增强）：
  - 会员与权益（收藏、关注店铺、积分说明）。
  - 营销：新客券、限时曝光位、区域活动位配置。
  - 评价与问答（匿名评价、店铺回复）。
  - 售后与纠纷流程优化（举证通道、质检标签）。
  - 风控策略（异常商家/异常订单识别与拦截）。
  - 多门店商家管理（统一结算、员工核销权限）。
- P2（进阶）：
  - 数据化定价辅助（根据历史售罄率提示建议价位区间）。
  - 物流/到店自提混合（与同城配送合作，按区域策略开放）。
  - 跨城运营支持（多区域分级运营权限）。

## 五、业务规则（关键约束）
- “惊喜袋”内容不展示具体单品，强调价值范围与品类说明；
- 下单后仅在提货时间段内有效；逾期未取货的处理策略由运营定义（例如：自动取消或限次豁免，具体数值均由运营配置）。
- 退款政策：
  - 提货前可申请退款（是否扣除服务费由运营配置）。
  - 提货后支持质量问题退款申请，需商家审核或平台介入。
- 价格与分成：价格由商家设置，平台服务费与结算周期由运营配置（不在文档内设定具体比例）。
- 限购与防刷：同用户对同店在同一提货时段限购策略由运营配置。

## 六、支付与结算
- 支付：小程序内微信支付。
- 结算：平台收取服务费后与商家周期性结算；结算单与对账导出由后台提供。
- 发票与税务：根据商家或平台开票策略执行（遵循当地监管要求）。

## 七、合规与隐私
- 用户数据合规：遵守微信平台与当地个人信息保护法规；最小化采集原则，明确用途与展示隐私政策入口。
- 商家资质：营业执照、食品经营许可证等入驻审核；违规商家下架与封禁流程。
- 内容合规：对“惊喜袋”描述与图片进行审核与巡检。

## 八、非功能需求
- 性能：核心页面首屏尽量控制在可接受范围（实际数值由性能指标方案确定）。
- 可用性：核心交易链路高可用；失败重试与降级策略。
- 可靠性：订单、支付与核销数据具备事务性保障与幂等处理。
- 安全：权限分级、接口鉴权、敏感信息加密、风控拦截。
- 监控：日志、指标、告警、链路追踪；灰度与回滚策略。
- 成本：存储、流量、计算资源成本可视化与预算控制。

## 九、MVP 范围与里程碑
- 里程碑 M1：基础 C 端浏览与下单、商家端发布与核销、后台商家审核与订单查询。
- 里程碑 M2：订阅消息提醒、基础评价与售后、简版数据看板。
- 里程碑 M3：区域活动与曝光位、风控初版、对账与结算导出。

## 十、关键指标（不设具体数值）
- 消费者侧：点击率、下单转化率、订单完成率、退款率、评价率。
- 商家侧：发布频次、售罄率、核销准时率、复购率。
- 平台侧：GMV、服务费收入占比、活跃商家数、活跃用户数、客服工单处理时长。

## 十一、技术方案与选型

### 1) 前端（小程序）
- 框架：微信小程序原生（WXML/WXSS/JS/TS），适配当前项目结构。
- 语言：TypeScript（提升可维护性），ESLint 规范现有 .eslintrc.js。
- 状态管理：轻量方案（使用全局 app 或简单事件总线）；规模增加后可引入 mobx-miniprogram。
- UI 组件：自研轻量组件或引入第三方（例如 WUX/ColorUI），需审查包体积与合规。
- 地图与定位：腾讯位置服务（定位、附近店铺检索）。
- 支付：微信支付（小程序支付能力）。
- 消息：小程序订阅消息（下单成功、提货提醒、售后进度）。
- 媒体占位规范（遵循你的规则）：
  - 图标无素材时用红色图片占位；
  - 图片无素材时用黄色图片占位；
  - 视频无素材时用蓝色图片占位；
  - 其他文件无素材时用绿色图片占位。

### 2) 后端（最适合的选择：微信云开发一体化方案）
- 方案：微信云开发（TCB）
  - 云函数（Node.js/TypeScript）：订单、库存、核销、支付回调、消息推送。
  - 云数据库：文档型数据库存储用户、商家、惊喜袋、订单、支付、核销记录。
  - 云存储：商家资质、店铺图片等。
  - 云调用：微信支付、订阅消息、短信（如需）。
- 优点：与小程序深度集成、接入与运维简单、合规性与支付能力成熟、弹性扩展。
- 适用阶段：MVP 到增长初期最合适；后续如数据规模与治理需求提升，可平滑迁移至专用后端。

### 3) 后端（可扩展替代方案：NestJS + 数据库）
- 框架：Node.js + NestJS（TypeScript）。
- 数据库：PostgreSQL 或 MySQL（主从/读写分离），ORM 使用 Prisma 或 TypeORM。
- 缓存与队列：Redis（库存扣减、消息队列、限流）。
- 网关与鉴权：API Gateway（腾讯云），JWT + 会话绑定微信 openId/unionId。
- 部署：Serverless（SCF）或容器（TKE），日志与监控使用 Prometheus + Grafana 或云监控。
- 适用阶段：对复杂结算、跨区域多活、数据治理有更高需求时采用。

### 4) 基础设施与运维
- 环境：dev/staging/prod 分层；配置中心与密钥管理（TCB/云密钥）。
- CI/CD：基于代码托管平台与云函数/容器自动部署。
- 监控：接口耗时、错误率、订单与支付告警、消息投递成功率；链路追踪可采用云原生日志链路或 OpenTelemetry。
- 风控：黑名单、限流、异常交易检测；运营后台介入能力。

## 十二、核心数据模型（字段示例，不含具体数值）
- 用户 User：openId、unionId、昵称、头像、手机号（可选）、状态。
- 商家 Merchant：基础信息、资质、门店列表、结算账户、状态。
- 门店 Store：位置信息、营业时间、关联商家、状态。
- 惊喜袋 SurpriseBag：店铺、提货时间段、数量、价格、标签（品类说明）、状态。
- 订单 Order：用户、惊喜袋、金额、状态（待提货/已提货/退款中/已退款）、码值。
- 支付 Payment：订单、支付渠道、交易号、回调状态、退款单关联。
- 核销 Redemption：订单、门店、员工、时间戳、方式（扫码/码值输入）。

## 十三、API 概览（示意，不含具体参数值）
- C 端：
  - GET /stores/nearby：附近门店与惊喜袋列表。
  - GET /bags/{id}：惊喜袋详情。
  - POST /orders：创建订单（返回预支付信息）。
  - POST /payments/notify：支付回调（服务端）。
  - GET /orders/{id}：订单详情。
  - POST /orders/{id}/refund：申请退款。
  - GET /messages/subscription-key：订阅消息 key 拉取与下发。
- 商家端：
  - POST /bags：发布惊喜袋。
  - PATCH /bags/{id}：编辑与上下架。
  - GET /merchant/orders：订单列表。
  - POST /orders/{id}/redeem：核销。
- 运营后台：
  - POST /merchant/apply：商家入驻申请材料提交与审核流程。
  - GET /dashboard：核心数据看板与导出。

## 十四、页面信息架构（小程序）
- C 端：
  - 首页（附近与推荐）
  - 店铺详情 & 惊喜袋详情
  - 下单与支付结果页
  - 订单列表与订单详情
  - 个人中心（基础设置、消息订阅、帮助与反馈）
- 商家端：
  - 发布惊喜袋
  - 订单与核销
  - 门店管理
  - 账务与报表（基础）
- 运营后台（Web 或小程序内嵌 H5）：
  - 商家审核
  - 内容与活动配置
  - 数据看板

## 十五、风险与应对
- 供给不足导致转化低：拓展商家类型与区域运营，活动扶持。
- 质量与体验问题：提货时间与保存条件明确、质检标签与售后通道。
- 刷单与欺诈：限购、设备指纹与风控策略、人工复核。
- 高峰期性能：库存扣减与订单链路使用事务与幂等，热点数据缓存与限流。

## 十六、实施建议与路线
- 最适合的技术栈用于 MVP：微信小程序原生 + 微信云开发（TCB）。
- 随业务增长，逐步引入：独立后端（NestJS）、关系型数据库、Redis、消息队列与更完善的运营后台。
- 全程遵守素材占位颜色规范，避免未提供素材导致的阻塞；等素材到位后逐步替换。

（本文档不使用虚构数据与具体数值，所有可配置参数均由运营与合规在实现阶段设定。）